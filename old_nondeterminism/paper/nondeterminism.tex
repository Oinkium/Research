\documentclass{entcs} \usepackage{prentcsmacro}
\sloppy
% The following is enclosed to allow easy detection of differences in
% ascii coding.
% Upper-case    A B C D E F G H I J K L M N O P Q R S T U V W X Y Z
% Lower-case    a b c d e f g h i j k l m n o p q r s t u v w x y z
% Digits        0 1 2 3 4 5 6 7 8 9
% Exclamation   !           Double quote "          Hash (number) #
% Dollar        $           Percent      %          Ampersand     &
% Acute accent  '           Left paren   (          Right paren   )
% Asterisk      *           Plus         +          Comma         ,
% Minus         -           Point        .          Solidus       /
% Colon         :           Semicolon    ;          Less than     <
% Equals        =3D           Greater than >          Question mark ?
% At            @           Left bracket [          Backslash     \
% Right bracket ]           Circumflex   ^          Underscore    _
% Grave accent  `           Left brace   {          Vertical bar  |
% Right brace   }           Tilde        ~

\input{preamble}

\newcommand{\stle}{{\;\le_s\;}}
\newcommand{\steq}{{\;=_s\;}}
\newcommand{\exle}{\sqsubseteq}
\newcommand{\exlub}{\bigsqcup}
\newcommand{\dv}{{\lightning}}
\DeclareMathOperator{\pocl}{pocl}
\newcommand{\opto}{\longrightarrow}
\newcommand{\n}{{\mathtt{n}}}
\newcommand{\IfO}{{\mathtt{If0}\;}}
\newcommand{\suc}{{\mathtt{suc\;}}}
\newcommand{\0}{{\mathtt{0}}}
\newcommand{\plot}{\triangleleft}
\newcommand{\shad}{\mathfrak{S}}
\newcommand{\tree}{\mathfrak{T}}
\newcommand{\Tau}{T}
\newcommand{\Chi}{X}

\def\lastname{Gowers}
\begin{document}
\begin{frontmatter}
  \title{A sound and adequate game semantics for PCF with countable nondeterminism} \author{John
    Gowers\thanksref{ALL}\thanksref{myemail}}
  \address{Department of Computer Science \\ University of Bath \\
    Bath, United Kingdom} \thanks[ALL]{Research supported by an
    EPSRC-SCI-DTA grant.  The author is indebted to
    his supervisor, Jim Laird, without whose research and guidance
    this paper could not have been written.} \thanks[myemail]{Email:
    \href{mailto:wjg27@bath.ac.uk} {\texttt{\normalshape
        W.J.Gowers@bath.ac.uk}}} 
\begin{abstract} 
  We give a sound and adequate game semantics for a simple extension of PCF with countable nondeterminism, given in \cite{LairdOrdinalGames}.  The model is based on the model of idealized Algol with finite nondeterminism given by Harmer and McCusker \cite{mcCHFiniteND} with extra information about infinite plays in order to accommodate infinite nondeterminism.  Our proof of soundness for the model is standard, but the proof of adequacy makes use of a new technique that is linked to the possibly transfinite complexity of evaluation trees in the presence of countable nondeterminism.
\end{abstract}
\begin{keyword}
  Game semantics, countable nondeterminism, ordinal complexity
\end{keyword}
\end{frontmatter}

\section{Introduction}

{\it I would like to expand this section and flesh out the examples a bit more to make them clearer.}

The basic idea underpinning the game semantics for nondeterministic programming languages is to remove the constraint of \emph{determinism} from the usual definition of a strategy (see, for example, \cite{abramskyjagadeesangames}) that says that the player may have at most one reply to each move made by the opponent.  The determinism constraint is of little technical value and its main purpose is to provide a fully abstract denotational semantics for deterministic programming languages; if we remove it in order to study nondeterministic languages, then much of the technical apparatus of game semantics carries over immediately.  

One problem that does arise, however, is that the resulting semantics no longer adequately captures the possibility of divergence in the interaction.  In deterministic game semantics, divergence is represented by the absence of a reply to an opponent's move, but this is not adequate in the nondeterministic case because it gives us no way to capture a \emph{possible} divergence.  For example, if we represent divergence by the abence of a reply then Program A, which constantly returns the numeral $1$, and Program B, which makes a nondeterministic choice and then either returns $1$ or diverges, have the same semantics, despite exhibiting different behaviour \cite{mcCHFiniteND}.

We therefore need a new way to keep track of divergence.  This was done by Harmer and McCusker \cite{mcCHFiniteND}, who resolved the problem by adding extra data to the definition of a strategy that records which opponent positions allow the possibility of divergence.  Using this device, Harmer and McCusker were able to provide a fully abstract game semantics for PCF with finite nondeterminism.

There is, however, a technical subtlety that arises when we try to use the same technique to model PCF with \emph{unbounded} nondeterminism; that is, PCF with the addition of a nondeterministic natural number generator that never diverges.  Indeed, if we naively relax the Harmer-McCusker model to allow infinite branching then composition of strategies is no longer associative \cite{RusssThesis}.  

Ultimately, the reason why unbounded nondeterminism introduces problems is that it makes the language fine-grained enough to distinguish between computation that is \emph{divergent}; i.e., a computation that carries on for infinitely many steps and does not terminate, and computation that is convergent, but may take an unbounded number of steps to do so.  For example, using recursion, we may define a function that, at each step, makes a nondeterministic choice whether to call its argument or to return.  If we have access to unbounded nondeterminism then we may write a function that nondeterministically chooses a natural number $n$, calls its argument $n$ times and then returns.  Observationally, these programs are different: the first may diverge, while the second always converges.  In the usual model of strategies as sets of positions, the strategies defined by these two programs are the same.  

At first glance, it appears that the Harmer-McCusker model is fine-grained enough to distinguish these two strategies, and this is true if we define the strategies directly: the strategy denoting the first program ought to designate the opening move as divergent, whereas the strategy denoting the second program should not designate any positions as divergent.  However, if we want to define these strategies compositionally, it turns out that both strategies are designated divergent, since the model treats an infinite increasing sequence of positions as a divergence occurring from livelock (the `infinite chattering' in the game semantics).  This inconsistency between the direct definition of the strategy and the compositional one is what leads to the failure of composition to be associative.  

We need, then, some way to distinguish between computation that takes infinitely many steps and computation that takes a finite, but arbitrarily large, number of steps.  One approach, taken by Tsukada and Ong \cite{TsukadaSheaves} is to represent strategies as trees, rather than sets of positions; here, there is a distinction between a tree of infinite height and an infinite family of trees of finite but arbitrarily large height.  We take a different approach, one suggested by the work of Roscoe and Levy (\cite{RoscoeCspInfinite} and \cite{LevyGsInfinite}, cited in \cite{TsukadaSheaves}), and by Laird's sequential algorithms model for PCF with unbounded nondeterminism \cite{LairdOrdinalGames}, and enlarge our strategies to include information about the infinite positions that may occur in them.  

\subsection{Related Work}

A more detailed overview of previous work, particularly \cite{LairdOrdinalGames}.

\section{PCF with Countable Nondeterminism}

As in \cite{LairdOrdinalGames}.  

\subsection{Type Theory}

\subsection{Operational Semantics}

\subsection{Must Testing}

We are interested in soundness and adequacy for the `must-converge' relation, since the `may-converge' relation can be adequately modelled using finite nondeterminism.  

\section{Game Semantics}

\subsection{Games}

\begin{definition}

  Given a set $X$, we write $\seqs X$ for the set of all (finite and infinite) sequences of elements of $X$ of length $\le \omega$.  

  A \emph{game} is given by a tuple
  \[
    A = (M_A, \lambda_A, \zeta_A, P_A)
    \]
  where
  \begin{itemize}
    \item $M_A$ is a set of moves.
    \item $\lambda_A\from M_A\to\OP$ designates each move as an $O$-move (played by Player $O$) or a $P$-move (played by Player $P$).  
    \item $P_A\subset \seqs{M_A}$ is a non-empty prefix-closed set of sequences of moves from $M_A$ of length $\le\omega$, called \emph{positions}.  We call a sequence $s\in P_A$ \emph{infinite} if $\length(s)=\omega$.  Otherwise, we say that $s$ is \emph{finite}.
    \item $\zeta_A\from P_A\to\OP$ designates each position in $P_A$ as a $P$-position or an $O$-position.
  \end{itemize}

  The set $P_A$ and the functions $\lambda_A,\zeta_A$ are required to satisfy certain additional axioms:
  \begin{description}
    \item[Compactness] If $s\in M_A^\omega$ is an infinite sequence of moves such that $t\in P_A$ for all finite prefixes $t\ppprefix s$, then $s\in P_A$.
    \item[Consistency] If $a\in M_A$ and $sa\in P_A$ then $\zeta_A(sa)=\lambda_A(a)$.
    \item[Alternation] If $a\in M_A$ and $sa\in P_A$ then $\zeta_A(s) = \neg \zeta_A(sa)$.
    \item[Negativity] $\zeta_A(\epsilon)=P$, where $\epsilon$ is the empty position.
  \end{description}

  Note that the negativity rule and the alternation rule between them imply that all starting moves are made by player $O$.  
\end{definition}

We shall write $P_A^P=\zeta_A\inv(\{P\})$ for the set of $P$-positions in $A$ and $P_A^O=\zeta\inv(\{O\})$ for the set of $O$-positions in $A$.

\subsection{Strategies}

A nondeterministic \emph{strategy} for a game $A$ will be given by a pair $\sigma=(T_\sigma, D_\sigma)$, where
\begin{itemize}
  \item $T_\sigma$ is the set of \emph{traces} of the strategy; i.e., the set of $P$-positions that can occur when player $P$ plays according to the strategy.  That is, $T_\sigma$ is a non-empty prefix-closed subset of $P_A^P$.  

  \item $D_\sigma\subset T_\sigma$ denotes the set of \emph{divergences} in $T_\sigma$; that is, the set of those $O$-positions in $T_\sigma$ for which Player $P$ may elect to diverge rather than respond.  Accordingly, $\zeta_A(s)=O$ for all $s\in D_\sigma$.  If a trace has a divergent prefix, then it is divergent, so we shall follow Roscoe and insist that $D_\sigma$ be postfix-closed in $P_A^O$ (\cite{RoscoeCspInfinite}, cited in \cite{mcCHFiniteND}).
\end{itemize}

\begin{definition}
  Let $A=(M_A,\lambda_A,\zeta_A,P_A)$ be a game.  Then a (nondeterministic) \emph{strategy} for $A$ is a pair $\sigma=(T_\sigma,D_\sigma)$ such that
  \begin{itemize}
    \item $T_\sigma\subset P_A^P$ is prefix-closed.
    \item $D_\sigma\subset P_A$ is a postfix-closed subset such that all of the minimal positions in $D_\sigma$ are replies to moves in $T_\sigma$ or limits of moves in $T_\sigma$.  In other words, if $s\in D_\sigma$, then there is some $O$-position $t\prefix s$ such that $t\in D_\sigma$ and all $P$-prefixes of $t$ are contained in $T_\sigma$.
  \end{itemize}

  $T_\sigma$ and $D_\sigma$ are required to satisfy the following totality axiom:
  \begin{description}
    \item[Diverge-or-reply] If $s\in T_\sigma$ and $sa\in P_A$ then either $sab\in T_\sigma$ for some $P$-move $b$ or $sa\in D_\sigma$.  
  \end{description}

  The diverge-or-reply rule tells us that a function must either return a value or go into an infinite loop, and corresponds to the absence of an error constant in our language.  
\end{definition}

We will need one extra condition on the definition of a strategy in order to make sure that the composition of two strategies satisfies the diverge-or-reply rule.

\begin{definition}
  We say a strategy $\sigma$ is \emph{compact} if $T_\sigma\cup D_\sigma$ satisfies the compactness criterion given above for games: if $s\in M_A^\omega$ is an infinite sequence such that $t\in T_\sigma$ for all finite $P$-prefixes $t\ppprefix s$, then $t\in T_\sigma$ or $t\in D_\sigma$.  
\end{definition}

Compactness is too strong a condition for our purposes: we shall later see that it is not preserved by composition.  We shall use the following local version instead:

\begin{definition}
  We say a strategy $\sigma$ is \emph{locally compact} if whenever $s\in T_\sigma$ there is some compact strategy $\sigma'$ such that $s\in T_{\sigma'}\subset T_\sigma$ and $D_\sigma\subset D_{\sigma'}$.
\end{definition}

From now on, we shall use the word \emph{strategy} to mean \emph{locally compact strategy}.

\subsection{Multiplicatives}

Let $A,B$ be games.  If $s\in \seqs{(M_A\cprd M_B)}$ then we write $s\vert_A$ for the subsequence of $s$ consisting of all moves from $A$ and $s\vert_B$ for the subsequence of $s$ consisting of all moves from $B$.  We write $P_A\|P_B$ for the set of all such sequences $s$ such that $s\vert_A\in P_A$ and $s\vert_B\in P_B$.  

\begin{definition}
  Let $A,B$ be games.  Then the \emph{tensor product} of $A$ and $B$ is the game $A\tensor B=(M_{A\tensor B}, \lambda_{A\tensor B}, \zeta_{A\tensor B}, P_{A\tensor B})$ where we define $M_{A\tensor B}$, $\lambda_{A\tensor B}$, $\zeta_{A\tensor B}$, $P_{A\tensor B}$ as follows:
  \begin{itemize}
    \item $M_{A\tensor B} = M_A \cprd M_B$
    \item $\lambda_{A\tensor B} = \lambda_A \cprd \lambda_B$
    \item For $s\in P_A\|P_B$, $\zeta_{A\tensor B}(s) = \zeta_A(s\vert_A) \wedge \zeta_B(s\vert_B)$.
    \item $P_{A\tensor B}$ is the set of all sequences $s\in P_A\|P_B$ such that $s$ satisfies the alternating condition with respect to $\zeta_{A\tensor B}$: i.e., for all $t,ta\prefix s$, $\zeta_{A\tensor B}(t) = \neg\zeta_{A\tensor B}(ta)$.  
  \end{itemize}
\end{definition}

\begin{definition}
  Let $A,B$ be games.  Then the \emph{linear implication} of $A$ and $B$ is the game $A\implies B=(M_{A\implies B}, \lambda_{A\implies B}, \zeta_{A\implies B}, P_{A\implies B})$ where we define $M_{A\implies B}$, $\lambda_{A\implies B}$, $\zeta_{A\implies B}$, $P_{A\implies B}$ as follows:
  \begin{itemize}
    \item $M_{A\implies B} = M_A \cprd M_B$
    \item $\lambda_{A\implies B} = (\neg\circ\lambda_A) \cprd \lambda_B$
    \item For $s\in P_A\|P_B$, $\zeta_{A\implies B}(s) = \zeta_A(s\vert_A) \wedge \zeta_B(s\vert_B)$.
    \item $P_{A\implies B}$ is the set of all sequences $s\in P_A\|P_B$ such that $s$ satisfies the alternating condition with respect to $\zeta_{A\implies B}$.  
  \end{itemize}
\end{definition}

We want to prove that these are well formed games.

\begin{proposition}\label{TensorImpliesWellFormed}
  If $A,B$ are games then $A\tensor B$ and $A\implies B$ are games.
\end{proposition}

First, we will prove a useful lemma.

\begin{lemma}\label{signProfilesLemma}
  Let $A,B$ be games.  Given a position $s\in P_A\|P_B$, we define the \emph{sign profile} of $s$ to be given by the signs of its two components:
  \[
    \begin{array}{cc|c}
      \zeta_A(s\vert_A) & \zeta_B(s\vert_B) & \textrm{sign profile} \\
      \hline
      P & P & PP \\
      O & P & OP \\
      P & O & PO \\
      O & O & OO
    \end{array}
    \]
  If $s\in P_{A\tensor B}$ is a finite position, then $s$ cannot have sign profile $OO$.  If $s\in P_{A\implies B}$ is a finite position then $s$ cannot have sign profile $OP$.  
\end{lemma}
\begin{proof}
  By negativity, the empty sequence $\epsilon$ always has sign profile $PP$.  Otherwise, $s=s'a$ for some sequence $s'$ and some move $a$.  If $s\in P_{A\tensor B}$ and $s$ has sign profile $OO$, then $s$ is an $O$-position in $A\tensor B$.  Therefore, $s'$ is a $P$-position in $A\tensor B$ and so $s'$ must have sign profile $PP$, by the definition of $\zeta_{A\tensor B}$.  But this is impossible, as the move $a$ can only change the sign profile in one of the two components.  

  The proof for the linear implication is entirely similar.
\end{proof}

\begin{proof*}{Proof of Proposition \ref{TensorImpliesWellFormed}}
  Alternation is part of the definition and negativity is implied by the equations $P\wedge P = P$ and $P\Rightarrow P = P$.  The only tricky part is proving consistency of the $\lambda$ and $\zeta$ functions.  Since consistency applies only to positions with a last move, we may ignore the infinite plays in $A$ and $B$.  

  Suppose $sa\in P_{A\tensor B}$.  We wish to show that $\zeta_{A}(sa)=\lambda_A(a)$.  In the presence of alternation, this is equivalent to showing that $\zeta_A(s) = \neg \lambda_A(a)$.  We show this by cases on the sign profile of $s$.  By Lemma \ref{signProfilesLemma}, $s$ has sign profile $PP$, $OP$ or $PO$.  If $s$ has sign profile $PP$ then $s$ is a $P$-position.  Since $s\vert_A$ and $s\vert_B$ are both $P$-positions, $a$ must be an $O$-move, whether it occurs in $A$ or $B$.  

  If instead $s$ has sign profile $OP$ or $PO$, then $s$ is an $O$-position.  By alternation, $sa$ must be a $P$-position, so it must have sign profile $PP$.  By consistency and alternation for the games $A,B$, the move $a$ must be a $P$-move.  

  For compactness, suppose that $s\in M_{A\tensor B}^\omega$ is an infinite sequence of moves such that $t\in P_{A\tensor B}$ for all finite prefixes $t\ppprefix s$.  Then $s$ is certainly alternating.  Moreover, for all finite prefixes $t\ppprefix s\vert_A$, we have $t\in P_A$, and so therefore $s\vert_A\in P_A$ by compactness for $A$.  Similarly, $s\vert_B\in P_B$, and therefore, $s\in P_{A\tensor B}$.

  The proof for the linear implication is similar.
\end{proof*}

Looking at the proof above, we may deduce the following important fact:

\begin{proposition}
  In the tensor product $A\tensor B$, only player $O$ may switch games.  In the linear implication $A\implies B$, only player $P$ may switch games.
\end{proposition}

\subsection{Composition of Strategies}

Let $A,B,C$ be games, let $\sigma$ be a strategy for $A\implies B$ and let $\tau$ be a strategy for $B\implies C$.  We shall construct a strategy $\comp\tau\sigma$ for $A\implies C$.  

In order to define $T_{\comp\tau\sigma}$, we first define the set $\sigma\|\tau$, given by:
\[
  \sigma\|\tau = \left\{\s\in\seqs{(M_A\cprd M_B\cprd M_C)}\suchthat \s\vert_{A,B}\in\sigma,\;\s\vert_{B,C}\in\tau\right\}
  \]
We then define
\[
  T_{\comp\tau\sigma} = \{\s\vert_{A,C}\suchthat \s\in\sigma\|\tau\}
  \]
We need to prove that $T_{\comp\tau\sigma}\subset P_{A\implies B}$.  $\comp\tau\sigma$ is clearly prefix closed, and transitivity of $\Rightarrow$ proves that all positions in $T_{\comp\tau\sigma}$ are $P$-positions, so we need to show that every finite position in $T_{\comp\tau\sigma}$ has even length.

\begin{proposition}
  Let $A,B,C$ be games, let $\sigma$ be a strategy for $A\implies B$ and let $\tau$ be a strategy for $B\implies C$.  Suppose $s\in\comp\tau\sigma$ is finite.  Then $s$ has even length.
\end{proposition}
\begin{proof}
  Write $s=\s\vert_{A,C}$, where $\s\in\sigma\|\tau$.  Then we have
  \begin{align*}
    \length(s) & = \length(\s) - \length(\s\vert_B) \\
     & = \length(\s\vert_{A,B}) + \length(\s\vert_{B,C} - 2\length(\s\vert_B)
  \end{align*}
  $\s\vert_{A,B}$ and $\s\vert_{B,C}$ both have even length, since they are $P$-positions, so the result follows.
\end{proof}

Before we consider the definition of $D_{\comp\tau\sigma}$, we show that composition is associative at the level of trace sets.  

\begin{proposition}\label{traceAssociativity}
  Let $A,B,C$ be games, let $\sigma$ be a strategy for $A\implies B$, let $\tau$ be a strategy for $B\implies C$ and let $\upsilon$ be a strategy for $C\implies D$.  Then
  \[
    T_{\comp{\upsilon}{(\comp\tau\sigma)}} = T_{\comp{(\comp\upsilon\tau)}{\sigma}}
    \]

\end{proposition}
  \begin{proof}
    As in \cite{abramskyjagadeesangames}.  Define
    \[
      \sigma\|\tau\|\upsilon = \left\{\s\in\seqs{(M_A \cprd M_B \cprd M_C \cprd M_D)} \suchthat \s\vert_{A,B}\in\sigma,\;\s\vert_{B,C}\in\tau,\;\s\vert_{C,D}\in\upsilon\right\}
      \]
    We shall show that 
    \[
      T_{\comp{\upsilon}{(\comp{\tau}{\sigma})}} = \{\s\vert_{A,D}\suchthat\s\in\sigma\|\tau\|\upsilon\}
      \]
    The same claim will follow for $T_{\comp{(\comp{\upsilon}{\tau})}{\sigma}}$ by symmetry, completing the proof.

    Let $\s\in\sigma\|\tau\|\upsilon$.  Then $\s\vert_{A,B,C}\in\sigma\|\tau$ and so $\s\vert_{A,C}\in\comp\tau\sigma$.  Now we see that $\s\vert_{A,C,D}\in (\comp\tau\sigma)\|\upsilon$ and so $\s\vert_{A,D}\in\comp{\upsilon}{(\comp\tau\sigma)}$.  We have shown that
    \[
      \{\s\vert_{A,D}\suchthat\s\in\sigma\|\tau\|\upsilon\} \subset T_{\comp{\upsilon}{(\comp{\tau}{\sigma})}}
      \]
    To show the reverse inclusion, suppose that $s\in\comp{\upsilon}{(\comp\tau\sigma)}$.  Let $\s\in(\comp\tau\sigma)\|\upsilon$ be such that $\s\vert_{A,D}=s$ and let $\t\in\sigma\|\tau$ be such that $\t\vert_{A,C}=\s\vert_{A,C}$.  Our goal is to interleave the sequences $\s$ and $\t$ in order to give rise to a sequence $\u\in\sigma\|\tau\|\upsilon$ such that $\u\vert_{A,D}=s$.  

    Note that since $\s\vert_{A,C}=\t\vert_{A,C}$, we may decompose $\s$ and $\t$ into blocks:
    \begin{gather*}
      \s = \s_0D_0\s_1D_1\dots\\
      \t = \s_0B_0\s_1B_1\dots
    \end{gather*}
    where $\s_1,\s_2,\dots$ are sequences of moves from either $A$ or $C$, $B_0,B_1\dots$ are (possibly empty) sequences of moves from $B$ and $D_0,D_1,\dots$ are (possibly empty) sequences of moves from $D$.

    We then form the sequence $\u$ as:
    \[
      \u = \s_0B_0D_0\s_1B_1D_1\dots
      \]
    It might look as if we have made an arbitrary choice in placing the $B_i$ before the $D_i$, but in fact it turns out that there is no choice to make: an examination of sign profiles, for example, will show that $B_i$ is non-empty only if $D_i$ is empty and vice versa: if $\s_i$ can be followed by a move from $B$ then it cannot be followed by a move from $D$.

    In any case, we have
    \begin{gather*}
      \u\vert_{A,C,D} = \s_0D_0\s_1D_1\dots = \s \\
      \u\vert_{A,B,C} = \s_0B_0\s_1B_1\dots = \t
    \end{gather*}
    It follows that $\u\in\sigma\|\tau\|\upsilon$: 
    \begin{gather*}
      \u\vert_{A,B} = \t\vert_{A,B} \in \sigma \\
      \u\vert_{B,C} = \t\vert_{B,C} \in \tau \\
      \u\vert_{C,D} = \s\vert_{C,D} \in \upsilon
    \end{gather*}
    Lastly, we have $\u\vert_{A,D} = \s\vert_{A,D} = s$, completing the proof.
  \end{proof}

At the moment, we have an associative composition at the level of trace sets.  We now define composition at the level of divergences.

Given a game $A$ and a subset $S\subset P_A$, we write $\pocl_A(S)$ for the postfix closure of $S$ in $P_A$; i.e.:
\[
  \pocl_A(S) = \{s\in P_A\suchthat t\prefix s\textrm{ for some $t\in S$}\}
  \]
We write $\pocl_A^P(S)$ for $\pocl_A(S)\cap P_A^P$ and $\pocl_A^O(S)$ for $\pocl_A(S)\cap P_A^O$.

\begin{definition}
  Let $A,B,C$ be games, let $\sigma$ be a strategy for $A\implies B$ and let $\tau$ be a strategy for $B\implies C$.  We define the divergences of $\comp\tau\sigma$ as follows: first we define
  \[
    \sigma\dv\tau = \left\{\s\in\seqs{(M_A\cprd M_B\cprd M_C)}\;\middle|\; \mbox{\pbox{\textwidth}{\flushRight either $\s\vert_{A,B}\in D_\sigma$ and $s\vert_{B,C}\in T_\tau$ \\ or $\s\vert_{A,B}\in T_\sigma$ and $s\vert_{B,C}\in D_\tau$}}\right\}
    \]
  \[
    D_{\comp\tau\sigma} = \pocl_{A\implies C}^O\left(\{\s\vert_{A,C}\suchthat\s\in\sigma\dv\tau\}\right)
    \]
\end{definition}

\begin{proposition}
  $D_{\comp\tau\sigma}$ is a well-defined divergence set.
\end{proposition}
  \begin{proof}
    $D_{\comp\tau\sigma}$ alternating by the same argument we used for $T_{\comp\tau\sigma}$, and is postfix-closed in $P_{A\implies C}^O$ by definition.  Now let $s\in D_{\comp\tau\sigma}$ and suppose that $\s\vert_{A,C}\prefix s$, where $\s\in \sigma\dv\tau$.  We need to show that there is some $O$-position $ta\prefix s$ such that $ta\in D_{\comp\tau\sigma}$ and $t\in T_{\comp\tau\sigma}$.

    Suppose first that $\s\vert_{A,B}\in D_\sigma$ and $\s\vert_{B,C}\in T_\tau$.  Then there is some $O$-position $r\prefix \s\vert_{A,B}$ such that $r\in D_\sigma$ and $q\in T_\sigma$ for all $P$-prefixes $q\prefix r$.  Let $\t\prefix\s$ be some prefix such that $\t\vert_{A,B}=r$.  Then $\t\in\sigma\dv\tau$ and so if we set $t=\t\vert_{A,C}$, we get that $t\in D_{\comp\tau\sigma}$.  If $u$ is a $P$-prefix of $t$, then there is some prefix $\u$ of $\t$ such that $\u\vert_{A,C}=u$.  Then $\u\vert_{A,B}$ is a $P$-position by examination of sign profiles and so $\u\vert_{A,B}\in T_\sigma$.  It follows that $u\in T_{\comp\tau\sigma}$.  

    The case where $\s\vert_{A,B}\in T_\sigma$ and $\s\vert_{B,C}\in D_\tau$ is similar.
  \end{proof}

We need to show that this composition satisfies the diverge-or-reply and local compactness rules.  

In order to prove that the composition of locally compact strategies is locally compact, we are going to need some facts about deterministic strategies.

\begin{definition}
  We say a strategy $\sigma$ is \emph{deterministic} if whenever $s\in\sigma$ is an $O$-position and $a,b$ are moves such that $sa,sb\in\sigma$, then $a=b$.
\end{definition}

Deterministic strategies have the following nice technical property:

\begin{proposition}
  Let $A,B,C$ be games, let $\sigma$ be a deterministic strategy for $A\implies B$ and let $\tau$ be a deterministic strategy for $B\implies C$.  Then $\comp\tau\sigma$ is a deterministic strategy.  Moreover, for any $s\in\comp\tau\sigma$, there is a unique minimal $\s\in\sigma\|\tau$ such that $\s\vert_{A,C}=s$.
\end{proposition}
  \begin{proof}
    The idea behind the proof is that determinism of $\sigma$ and $\tau$ mean that the play in the intermediate game $B$ is completely determined (since every move played in $B$ is either a $P$-move in $A\implies B$ or a $P$-move in $B\implies C$.  For full details, see \cite{abramskyjagadeesangames}.
  \end{proof}

We can use this to prove the following:

\begin{proposition}
  Let $A,B,C$ be games and let $\sigma\from A\implies B$ and $\tau\from B\implies C$ be compact deterministic strategies.  Then $\comp\tau\sigma$ is compact.
\end{proposition}
  \begin{proof}
    Let $s\in M_{A\implies C}^\omega$ be an infinite sequence such that $t\in\comp\tau\sigma$ for all finite prefixes $t\ppprefix s$.  For each finite prefix $t$ of $s$, there is a unique minimal sequence $\t\in\sigma\|\tau$ such that $\t\vert_{A,C}=t$.  Writing $s$ as the limit of its finite $P$-prefixes
    \[
      t_1 \prefix t_2 \prefix t_3 \prefix \dots
      \]
    we build up a sequence
    \[
      \t_1 \prefix \t_2 \prefix \t_3 \prefix \dots
      \]
    where $\t_i$ is the unique minimal sequence in $\sigma\|\tau$ such that $\t_i\vert_{A,C}=t_i$.  We have $\t_i\prefix\t_{i+1}$ because if we remove the last move from $\t_{i+1}$ then the resulting sequence $\u_i$ satisfies $\u_i\vert_{A,C}=t_i$ and therefore $\t_i\prefix\u_i\prefix\t_{i+1}$ by minimality of $\t_i$.  

    Then the limit of the sequences $\t_i\vert_{A,B}$ must be contained in $T_\sigma\cup D_\sigma$, since $\sigma$ is compact, and similarly the limit of the sequences $\t_i\vert_{B,C}$ must be contained in $T_\tau\cup D_\tau$, since $\tau$ is compact.  It follows that the limit $\t$ of the sequences $\t_i$ is contained in $\sigma\|\tau\cup\sigma\dv\tau$, and therefore that $\t\vert_{A,C}=s\in T_{\comp\tau\sigma}\cup D_{\comp\tau\sigma}$.
  \end{proof}

Note that the composition of compact nondeterministic strategies need not be compact.

\begin{example}
  Let the games $I$ and $\st$ be defined as before, and let the game $\Sigma$ be the game with a unique opponent starting move and a unique player reply:
  \[
    \Sigma = (\{q,a\}, \{q\mapsto o, a\mapsto p\}, \{\epsilon\mapsto p,q\mapsto o,qa\mapsto p\}, \{\epsilon, q, qa\}\}
    \]
  Let $\bN$ be the game where the opponent asks the player to choose a natural number:
  \[
    \bN = \left(\{q\} \cup \bN, \{q\mapsto O, n\mapsto P\}, \{\epsilon\mapsto P,q\mapsto O,qn\mapsto P\}, \{\epsilon, q\} \cup \{qn\suchthat n\in\bN\}\right)
    \]
  We have a (deterministic) strategy $\sigma$ for $\bN\implies (\st\implies\Sigma)$ in which the player asks the opponent for a number $n$ and then calls the argument of $\st$ $n$ times before returning.  For example, a play in $\sigma$ might look like this:
  \[
    \begin{array}{ccc}
      \bN & \st & \Sigma \\
      & & q \\
      q & & \\
      2 & & \\
      & q & \\
      & a & \\
      & q & \\
      & a & \\
      & & a
    \end{array}
    \]
  $\sigma$ is compact because there are no infinite chains of positions; indeed, the length of a play in $\sigma$ is already determined by the third move.  

  We have a nondeterministic strategy $\wn$ for $\bN\cong I\implies\bN$ where the player nondeterministically chooses any number - so $\wn = P_{\bN}^P$ as sets of positions.  $\wn$ is compact because all plays in $\wn$ have length at most $2$.  

  When we compose these strategies, the resulting strategy $\comp\sigma\wn$ contains the infinite chain of positions $qq,qqaq,qqaqaq,qqaqaqaq,\dots$, but does not contain any limiting plays.  So it is not compact.  It is, however, locally compact, since it is the union of compact strategies $\sigma_n$, where $\sigma_n$ has the unique maximal play
  \[
    q\underbrace{qa\dots qa}_{\textrm{$n$ times}}a
    \]
\end{example}

\begin{proposition}
  Let $A,B,C$ be games and let $\sigma\from A\implies B$ and $\tau\from B\implies C$ be (nondeterministic, locally compact) strategies.  Then $\comp\tau\sigma$ is locally compact.
\end{proposition}
  \begin{proof}
    Let $s\in T_{\comp\tau\sigma}$.  Then there is some sequence $\s\in\sigma\|\tau$ such that $\s\vert_{A,C}=s$.  We have $\s\vert_{A,B}\in\sigma$ and $\s\vert_{B,C}\in\tau$, so, by local compactness for $\sigma$ and $\tau$, there are compact strategies $\sigma'\from A\implies B$ and $\tau'\from B\implies C$ such that $\s\vert_{A,B}\in\sigma'$ and $\s\vert_{B,C}\in\tau'$.  After removing positions from (and possibly adding divergences to) $\sigma'$ and $\tau'$, we may assume that they are deterministic (and still compact).  Then $\comp{\tau'}{\sigma'}$ is compact and we have $\s\vert_{A,C}\in\comp{\tau'}{\sigma'}\subset\comp\tau\sigma$ and $D_{\comp\tau\sigma}\subset D_{\comp{\tau'}{\sigma'}}$.
  \end{proof}

Unlike \cite{mcCHFiniteND}, we do not need to change the definition of $D_{\comp\tau\sigma}$ to reflect divergence arising from infinite chattering.  The following example shows that it arises naturally from existing definition of $D_{\comp\tau\sigma}$.

\begin{example}[Infinite chattering]
  Let $\st$ denote the game where each player has exactly one move available in every position and the resulting infinite position is a $P$-position:
  \[
    \st = (\{q, a\}, \{q\mapsto O, a\mapsto P\}, \{\epsilon\mapsto P,sq\mapsto O,sa\mapsto P,qaqa\dots\mapsto P\}, \{s\prefix qaqa\dots\})
    \]
  Let $I$ denote the empty game with no moves, and let $\bot$ denote the game with a single opponent move and no player reply:
  \begin{gather*}
    I = (\emptyset, \emptyset, \{\epsilon\mapsto P\}, \{\epsilon\}) \\
    \bot = (\{*\}, \{*\mapsto O\}, \{\epsilon\mapsto P, *\mapsto O\}, \{\epsilon, *\})
  \end{gather*}
  There are natural strategies $\sigma$ for $I\implies\st$ and $\tau$ for $\st\implies\bot$ given at the level of traces by:
  \begin{gather*}
    \sigma = \{s \prefix^P qaqa\dots\} \\
    \tau = \{s \prefix^P *qaqa\dots\}
  \end{gather*}
  Player $P$ always has a reply to an $O$-position in $\sigma$, and we set $D_\sigma = \emptyset$.  In $\tau$, the infinite sequence $*qaqa\dots$ satisfies $\zeta_{\st}(*qaqa\dots\vert_{\st}) = \zeta_{\st}(qaqa\dots) = P$ and $\zeta_{\bot}(*qaqa\dots\vert_{\bot}) = \zeta_{\bot}(*) = O$ and so it is an $O$-position.  We set
  \[
    D_\tau = \{*qaqa\dots\}
    \]
  Now, when we compose the strategies $\sigma$ and $\tau$, at the level of traces we have
  \[
    \comp\tau\sigma = \{\epsilon, *\}
    \]
  The sequence $*$ is the restriction to $I,\bot$ of the infinite sequence
  \[
    *qaqa\dots \in \sigma\|\tau
    \]
  We now have that $*qaqa\dots\vert_{\st,\bot}\in D_\tau$ and therefore the sequence $*\in\comp\tau\sigma$ must be designated divergent.  We have
  \[
    D_{\comp\tau\sigma} = \{*\}
    \]
  as desired.

  Note that if we modify the definition of $\st$ so that the infinite position is an $O$-position, then we still get a divergence -- this time, because the sequence $*qaqa\dots\vert_{I,\sigma^*}$ must be contained in $D_\sigma$.  If we leave out the infinite position from $\sigma$ or $\tau$ altogether, then that strategy is no longer locally compact, so it is not a valid strategy according to our definition.
\end{example}

This example is at the heart of the proof that the composition of strategies satisfies the diverge-or-reply rule.  This is the point at which we need local compactness.

\begin{proposition}
  Let $A,B,C$ be games, let $\sigma$ be a strategy for $A\implies B$ and let $\tau$ be a strategy for $B\implies C$.  Then $T_{\comp\tau\sigma}, D_{\comp\tau\sigma}$ satisfy the diverge-or-reply rule.

\end{proposition}
  \begin{proof}
    Suppose that $s\in\comp\tau\sigma$, that $sa\in P_{A\implies C}$ and that $s\not\in D_{\comp\tau\sigma}$.  Let $\s\in\sigma\|\tau$ be such that $\s\vert_{A,C}=s$.  By local compactness of $\sigma$ and $\tau$, there must be compact strategies $\sigma'\from A\implies B$ and $\tau'\from B\implies C$ such that $\s\vert_{A,C}\in\sigma'$ and $\s\vert_{B,C}\in\tau'$.  
    
    Let $\s'\in\sigma'\|\tau'$ be maximal such that $\s'a\vert_{A,C}=sa$.  We know that such a maximal sequence must exist: if $\s_i$ are a chain of sequences from $\sigma'\|\tau'$ such that $\s_ia\vert_{A,C}=sa$ then their limit $\s$ (which is contained in $\sigma'\|\tau'$ by compactness of $\sigma'$ and $\tau'$) must satisfy $\s a\vert_{A,C}=s a$.  Since $sa\not\in D_{\comp\tau\sigma}$, we must have $\s a\vert_{A,B}\not\in D_\sigma\subset D_{\sigma'}$ and $\s a\vert_{B,C}\not\in D_\tau\subset D_{\tau'}$.  
    
    Since $sa$ is an $O$-position, one of $\s a\vert_{A,B}$ and $\s a\vert_{B,C}$ must be an $O$-position (by transitivity of $\Rightarrow$).  Suppose without loss of generality that $\s a\vert_{A,B}$ is an $O$-position.  Since $\s a\vert_{A,B}\not\in D_{\sigma'}$, there must be some move $b$ such that $\s a\vert_{A,B}b\in\sigma'$, since $\sigma'$ satisfies the diverge-or-reply rule.  Then we have $\s ab\vert_{A,B}\in\sigma'$.  Moreover, Lemma \ref{signProfilesLemma} tells us that $\s a\vert_{B,C}$ must be a $P$-position, so $\s ab\vert_{B,C}=\s\vert_{B,C}\in\tau'$.  Therefore, $\s ab\in\sigma'\|\tau'$.  By maximality of $\s a$, $b$ must be a move in $A$ and therefore we have $sab\in\comp{\tau'}{\sigma'}\subset\comp\tau\sigma$.
  \end{proof}

We now have a working definition of composition.  It remains to prove that it is associative at the level of divergences:

\begin{proposition}
  Let $A,B,C,D$ be games, let $\sigma$ be a strategy for $A\implies B$, let $\tau$ be a strategy for $B\implies C$ and let $\upsilon$ be a strategy for $C\implies D$.  Then 
  \[
    D_{\comp\upsilon{(\comp\tau\sigma)}} = D_{\comp{(\comp\upsilon\tau)}\sigma}
    \]
\end{proposition}
  \begin{proof}
    Let
    \[
      D = \left\{\s\in \seqs{(M_A \cprd M_B \cprd M_C \cprd M_D)} \;\middle|\;\mbox{\pbox{\textwidth}{\flushRight
        either \textbf{1} $\s\vert_{A,B}\in D_\sigma$, $\s\vert_{B,C}\in T_\tau$ and $\s\vert_{C,D}\in T_\upsilon$ \\
        or \textbf{2} $\s\vert_{A,B}\in T_\sigma$, $\s\vert_{B,C}\in D_\tau$ and $\s\vert_{C,D}\in T_\upsilon$ \\
        or \textbf{3} $\s\vert_{A,B}\in T_\sigma$, $\s\vert_{B,C}\in T_\tau$ and $\s\vert_{C,D}\in D_\upsilon$
      }}\right\}
      \]
    We claim that $D_{\comp\upsilon{(\comp\tau\sigma)}}=\pocl_{A\implies D}^O\left(\{\s\vert_{A,D}\suchthat\s\in D\}\right)$.  The same claim will hold for $D_{\comp{(\comp\upsilon\tau)}\sigma}$ by symmetry, completing the proof.

    Let $\s\in D$.  In cases \textbf{1} and \textbf{2}, we must have $\s\vert_{A,C}\in D_{\comp\tau\sigma}$ and $\s\vert_{C,D}\in T_\upsilon$.  In case \textbf{3}, we have $\s\vert_{C,D}\in D_\upsilon$ and $\s\vert_{A,C}\in T_{\comp\tau\sigma}$.  In either case, we must have $\s\vert_{A,D}\in D_{\comp\upsilon{(\comp\tau\sigma)}}$.

    Conversely, suppose that $s\in D_{\comp\upsilon{(\comp\tau\sigma)}}$.  Then there must be some $\t\in \seqs{(M_A\cprd M_C\cprd M_D)}$ such that $\t\vert_{A,D}\prefix s$ and either
    \[
      \t\vert_{A,C}\in D_{\comp\tau\sigma}\textrm{ and }\t\vert_{C,D}\in T_\upsilon
      \]
    or
    \[
      \t\vert_{A,C}\in T_{\comp\tau\sigma}\textrm{ and }\t\vert_{C,D}\in D_\upsilon
      \]
    In the first case, we then get a sequence $\u\in \seqs{(M_A\cprd M_B \cprd M_C)}$ such that $\u\vert_{A,C}\prefix\t\vert_{A,C}$ and either
    \[
      \u\vert_{A,B}\in D_\sigma\textrm{ and }\u\vert_{B,C}\in T_\tau
      \]
    or
    \[
      \u\vert_{A,B}\in T_\sigma\textrm{ and }\u\vert_{B,C}\in D_\tau
      \]
    By passing to a suitable prefix of $\t$, we may assume that $\u\vert_{A,C}=\t\vert_{A,C}$ (since $T_\upsilon$ is prefix-closed).

    In the second case, we get a sequence $\u\in\sigma\|\tau$ such that $\u\vert_{A,C}=\t\vert_{A,C}$.  

    By the argument from Proposition \ref{traceAssociativity}, we may interleave these two sequences $\t$ and $u$ to form a sequence $\s\in\seqs{(M_A\cprd M_B\cprd M_C\cprd M_D)}$ such that $\s\vert_{A,B,C}=\u$ and $\s\vert_{A,C,D}=\t$.  Then it is clear that $\s\in D$ in all cases and we have $\s\vert_{A,D}=\t\vert_{A,D}\prefix s$.
  \end{proof}

In order to show that we have a category, it remains to define the identity morphisms.  These are given by the usual copycat strategies:
\[
  \id_A = \{s\in P_{A_1\implies A_2}^P\suchthat\textrm{for all even length $t\prefix s$, $t\vert_{A_1}=t\vert_{A_2}$}\}
  \]
(Here, we consider infinite positions to have even length).

The divergence set $D_{\id_A}$ is empty: note that infinite positions in $\id_A$ are always $P$-positions.

\begin{theorem}
  There is a category $\G$ where the objects are games as defined above, morphisms from a game $A$ to a game $B$ are given by nondeterministic strategies $(T_\sigma, D_\sigma)$ for $A\implies B$ and the composition and identity morphisms are as defined above.
\end{theorem}
  \begin{proof}
    All that is left to do is to show that $\id_A$ really is an identity morphism.  We shall show that if $A$ and $B$ are games and $\sigma$ is a strategy for $A\implies B$ then $\comp\sigma{\id_A}=\sigma$; it will follow by a symmetrical argument that $\comp{\id_B}\sigma = \sigma$.

    We first show that $T_{\comp\sigma{\id_A}}=T_\sigma$.  If $s\in\comp\sigma{\id_A}$, then there is some sequence $\s\in\id_A\|\sigma$ such that $\s\vert_{A_1,B}=s$.  Since $\s\vert_{A_1,B}$ is a $P$-position, it must have sign profile $PPP$ or $OOO$ by Lemma \ref{signProfilesLemma}, and therefore $\s\vert_{A_1,A_2}$ is a $P$-position, so has even length.  Therefore, $\s\vert_{A_1}=\s\vert_{A_2}$ and so $s=\s\vert_{A_1,B}=\s\vert_{A_2,B}\in\sigma$.

    Conversely, suppose that $s\in\sigma$.  There is an obvious sequence $s^2\in\id_A$, given by copying the moves of $s\vert_A$ between copies of $A$, such that $s^2\vert_{A_1}=s^2\vert_{A_2}=s\vert_A$.  Then $s^2\vert_{A_2}=s\vert_{A_2}$, and so the sequences $s^2$ and $s$ may be interleaved as in the proof of Proposition \ref{traceAssociativity} to yield a sequence $\s\in\id_A\|\sigma$ such that $\s\vert_{A_1,B}=\s\vert_{A_2,B}=s$.  

    Now we show that $D_{\comp\sigma{\id_A}}=D_\sigma$.  Suppose $s\in D_{\comp\sigma{\id_A}}$.  Since $D_{\id_A}=\emptyset$, there is a sequence $\s\in\seqs{(M_{A_1}\cprd M_{A_2}\cprd M_B)}$ such that $\s\vert_{A_1,B}\prefix s$, $\s\vert_{A_1,B_1}\in\id_A$ and $\s\vert_{A_2,B}\in D_\sigma$.  In particular, $\s\vert_{A_2,B}$ is an $O$-position in $A\implies B$ and so $\s\vert_{A_2}$ is a $P$-position in $A$.  It follows by Lemma \ref{signProfilesLemma} that $\s\vert_{A_1,A_2}$ is a $P$-position in $A\implies A$; hence, it is even-length and so $\s\vert_{A_1}=\s\vert_{A_2}$.  Therefore, $\s\vert_{A_1,B}=\s\vert_{A_2,B}\in D_\sigma$, so $s\in D_\sigma$, since $D_\sigma$ is postfix-closed.  It follows that, $D_{\comp\sigma{\id_A}}\subset D_\sigma$.  

    Conversely, suppose that $s\in D_\sigma$.  We know already that there is some $\s\in\id_A\|\sigma$ such that $\s\vert_{A_1,A_2}\in\id_A$ and $\s\vert_{A_2,B}\in\sigma$.  Then $\s\vert_{A,C}\in D_{\comp\sigma{\id_A}}$ by definition.
  \end{proof}

\subsection{Symmetric monoidal closed structure}

We make the category $\G$ into a symmetric monoidal closed category with tensor product given by $\tensor$ and linear implication given by $\implies$.  At the level of morphisms, the action of $\blank\tensor\blank$ is defined as follows: if $A,B,C,D$ are games, $\sigma$ is a strategy for $A\implies C$ and $\tau$ is a strategy for $B\implies D$, then $\sigma\tensor\tau$ is the strategy for $(A\tensor B)\implies (C\tensor D)$ given by playing the strategy $\sigma$ in $A$ and $C$ and playing the strategy $\tau$ in $B$ and $D$:
\[
  \sigma\tensor\tau = \left\{s\in P_{(A\tensor B)\implies (C\tensor D)}\suchthat s\vert_{A,C}\in\sigma,\;s\vert_{B,C}\in\tau\right\}
  \]
The divergences for $\sigma\tensor\tau$ are defined using the divergences for $\sigma$ and $\tau$:
\[
  D_{\sigma\tensor\tau} = \pocl^O\left(\left\{s\in P_{(A\tensor B)\implies (C\tensor D)}\;\middle|\;\mbox{\pbox{\textwidth}{\flushRight
    either $s\vert_{A,C}\in D_\sigma$ and $s\vert_{B,D}\in T_\tau$ \\
    or $s\vert_{A,C}\in T_\sigma$ and $s\vert_{B,D}\in D_\tau$
    }}\right\}\right)
  \]
\begin{proposition}
  $\sigma\tensor\tau$ is a valid strategy for $(A\tensor B)\implies (C\tensor D)$
\end{proposition}
  \begin{proof}
    $\sigma\tensor\tau$ is non-empty and prefix-closed, since $\sigma$ and $\tau$ are.  
    
    $D_{\sigma\tensor\tau}$ is postfix-closed by definition.  If $s\in D_{\sigma\tensor\tau}$, we need to find some prefix $t\prefix s$ such that $t\in D_{\sigma\tensor\tau}$ and $u\in T_{\sigma\tensor\tau}$ for all $P$-prefixes $u\prefix t$.  By definition, we know there is some $s'\prefix s$ such that either $s'\vert_{A,C}\in D_\sigma$ and $s'\vert_{B,D}\in T_\tau$ or $s'\vert_{A,C}\in T_\sigma$ and $s'\vert_{B,D}\in D_\tau$.  In the first case, we know that there is some $r\prefix s'\vert_{A,C}$ such that $r\in D_\sigma$ and $q\in T_\sigma$ for all $P$-prefixes $q\prefix r$; passing to an appropriate prefix $s''$ of $s'$, we get that $s''\vert_{A,C}=r$ and $s''\vert_{B,D}\in T_\tau$.  Therefore, $s''\in D_{\sigma\tensor\tau}$ and $t''\in T_{\sigma\tensor\tau}$ for all $P$-positions $t''\prefix s''$.  Moreover, $s''$ is an $O$-position, since $s''\vert_{A,C}$ is, and the claim follows since $s''\prefix s'\prefix s$.  The proof in the other case is similar.

    Now we need to show that $\sigma\tensor\tau$ is locally compact.  We first show that if $\sigma$ and $\tau$ are compact strategies then $\sigma\tensor\tau$ is compact.  Indeed, suppose that $s\in\sigma\tensor\tau$ is an infinite sequence such that $t\in T_{\sigma\tensor\tau}\cup D_{\sigma\tensor\tau}$ for all finite prefixes $t\ppprefix s$.  Then $\sigma$ must contain all finite prefixes of $s\vert_{A,C}$, so one of $T_\sigma$ and $D_\sigma$ must contain $s\vert_{A,C}$, since $\sigma$ is compact.  Similarly, one of $T_{\tau}$ and $D_\tau$ must contain $s\vert_{B,D}$.  Therefore, $s\in T_{\sigma\tensor\tau}\cup D_{\sigma\tensor\tau}$.  Since $s$ was arbitrary, it follows that $\sigma\tensor\tau$ is compact.  

    Now suppose that $\sigma$ and $\tau$ are locally compact.  Let $s\in\sigma\tensor\tau$.  Then there exists a compact strategy $\sigma'$ for $A\implies C$ and $\tau'\from B\implies D$ such that $s\vert_{A,C}\in\sigma'\subset\sigma$ and $D_\sigma\subset D_{\sigma'}$ and a compact strategy $\tau'$ for $B\implies C$ such that $s\vert_{B,C}\in\tau'\subset \tau$ and $D_\tau\subset D_{\tau'}$.  Then $s\in\sigma'\tensor\tau'$, which is compact, and we have $\sigma'\tensor\tau'\subset\sigma\tensor\tau$ and $D_{\sigma\tensor\tau}\subset D_{\sigma'\tensor\tau'}$.

    Lastly, we need to show that $\sigma\tensor\tau$ satisfies diverge-or-reply.  Indeed, suppose that $s\in\sigma\tensor\tau$, that $sa\in P_{(A\tensor B)\implies (C\tensor D)}$ and that $sa\not\in D_{\sigma\tensor\tau}$.  Then $sa\vert_{A,C}\not\in D_\sigma$ and $sa\vert_{B,D}\not\in D_\tau$.  Using Lemma \ref{signProfilesLemma}, we see that $sa$ must have one of the following sign profiles:
    \[
      \begin{array}{cccc}
        \zeta_A(s\vert_A) & \zeta_B(s\vert_B) & \zeta_C(s\vert_C) & \zeta_D(s\vert_D) \\
        \hline
        P & P & P & O \\
        P & P & O & P
      \end{array}
      \]
    It follows that one of $sa\vert_{A,C}$ and $sa\vert_{B,D}$ must be an $O$-position.  Suppose without loss of generality that $sa\vert_{A,C}$ is an $O$-position.  Since $sa\vert_{A,C}\not\in D_\sigma$, there must be some move $b$ such that $sab\in\sigma$, since $\sigma$ satisfies diverge-or-reply.  Then we have $sab\in\sigma\tensor\tau$.
  \end{proof}

We also need to show that the tensor product respects composition.  This is easy.

\begin{proposition}
  Let $A'',A',A,B'',B',B$ be games and let $\sigma'\from A''\to A'$, $\sigma\from A'\to A$, $\tau'\from B''\to B'$, $\tau\from B'\to B$ be strategies.  Then
  \[
    \comp{(\sigma\tensor\tau)}{(\sigma'\tensor\tau')} = (\comp\sigma{\sigma'})\tensor(\comp\tau{\tau'})
    \]
\end{proposition}
  \begin{proof}
    At the level of trace sets, we have:
    \begin{gather*}
      (\comp\sigma{\sigma'})\tensor(\comp\tau{\tau'}) = \left\{s\in P_{(A''\tensor B'')\implies(A\tensor B)}\suchthat s\vert_{A'', A}\in\comp\sigma{\sigma'},\;s\vert_{B'', B}\in\comp\tau{\tau'}\right\}
    \end{gather*}
    Meanwhile:
    \begin{align*}
      (\sigma'\tensor\tau')\|(\sigma\tensor\tau) &= \left\{\s\in \seqs{(M_{A''\tensor B''}\cprd M_{A'\tensor B'}\cprd M_{A\tensor B})}\;\middle|\;{\mbox{\begin{minipage}{120pt}{
        \setlength{\abovedisplayskip}{-5pt}
        \setlength{\belowdisplayskip}{-10pt}
        \begin{IEEEeqnarray*}{cCc}
          \s\vert_{A''\tensor B'',A'\tensor B'} & \in & \sigma'\tensor\tau' \\
          \s\vert_{A'\tensor B',A\tensor B} & \in & \sigma\tensor\tau
        \end{IEEEeqnarray*}}
        \normalsize
      \end{minipage}}}\right\} \\[1em]
      &= \left\{\s\in \seqs{(M_{A''\tensor B''}\cprd M_{A'\tensor B'}\cprd M_{A\tensor B})}\;\middle|\;{\mbox{\begin{minipage}{80pt}{
        \setlength{\abovedisplayskip}{-5pt}
        \setlength{\belowdisplayskip}{-10pt}
        \begin{IEEEeqnarray*}{cCc}
          \s\vert_{A'', A'} & \in & \sigma' \\
          \s\vert_{A', A} & \in & \sigma \\
          \s\vert_{B'', B'} & \in & \tau' \\
          \s\vert_{B', B} & \in & \tau
        \end{IEEEeqnarray*}}
        \normalsize
      \end{minipage}}}\right\} \\[1em]
      &= \left\{\s\in \seqs{(M_{A''\tensor B''}\cprd M_{A'\tensor B'}\cprd M_{A\tensor B})}\;\middle|\;{\mbox{\begin{minipage}{80pt}{
        \setlength{\abovedisplayskip}{-5pt}
        \setlength{\belowdisplayskip}{-10pt}
        \begin{IEEEeqnarray*}{cCc}
          \s\vert_{A'', A', A} & \in & \sigma'\|\sigma \\
          \s\vert_{B'', B', B} & \in & \tau'\|\tau
        \end{IEEEeqnarray*}}
        \normalsize
      \end{minipage}}}\right\}
    \end{align*}

    It follows that
    \[
      \comp{(\sigma\tensor\tau)}{(\sigma'\tensor\tau')}
      = \left\{\s\vert_{A''\tensor B'', A\tensor B}\suchthat\s\in(\sigma'\tensor\tau')\|(\sigma\tensor\tau)\right\}
      = (\comp\sigma{\sigma'})\tensor(\comp\tau{\tau'})
      \]

    We can show that
    \[
      D_{\comp{(\sigma\tensor\tau)}{(\sigma'\tensor\tau')}} = D_{(\comp\sigma{\sigma'})\tensor(\comp\tau{\tau'})}
      \]
    using a similar argument.
  \end{proof}

The associators, unitors and braiding for this tensor product are the usual (deterministic, compact, non-divergent) copycat strategies.  It is straightforward to show that they are natural transformations, using the same argument we used to show that $\id_A$ is an identity, and that the appropriate coherence diagrams are satisfied.  

Closedness follows immediately from the structural isomorphism
\[
  (A \tensor B) \implies C \cong A \implies (B \implies C)
  \]
for all games $A,B,C$, together with the definition of morphisms as strategies on the linear implication.

\subsection{Exponentials}

Let $A$ be a game.  We define a game $\oc A$ in which the opponent may at any point open a new copy of the game $A$:
\[
  \oc A = (M_{\oc A}, \lambda_{\oc A}, \zeta_{\oc A}, P_{\oc A})
  \]
where
\begin{itemize}
  \item $M_{\oc A} = \omega \times M_A$
  \item $\lambda_{\oc A} = \lambda_A \circ \pr_2$
\end{itemize}

Given some sequence $s\in \seqs{M_{\oc A}}$, we write $s\vert_n$ for the projection on to the second component of the subsequence of $s$ consisting of those moves of the form $(n, a)$.  We define
\[
  \oc P_A = \left\{s\in\seqs{M_{\oc A}} \suchthat s\vert_n\in P_A \textrm{ for all $n\in\omega$}\right\}
  \]
We define $\zeta_{\oc A}\from \oc P_A\to\OP$ by
\[
  \zeta_{\oc A}(s) = \bigwedge_{n\in\omega}\zeta_A(s\vert_n)
  \]
Lastly, we define $P_{\oc A}$ to be the subset of $\oc P_A$ consisting of all those terms that are alternating with respect to $\zeta_{\oc A}$ and that satisfy the following criterion on the order in which copies of $A$ may be opened:
\begin{description}
  \item[Ordering criterion] If the move $(n + 1, a)$ occurs in $s$, for $n\ge 0$, then there must be some move $b$ such that $(n, b)$ occurs earlier in the sequence $s$ than $(n + 1, a)$.  
\end{description}

This criterion says that player $O$ must open the copies of $A$ in sequence: he is not allowed to play in game $n+1$ till he has made a move in game $n$.

\begin{proposition}
  $\oc A$ is a well formed game.
\end{proposition}
  \begin{proof}
    Exactly the same argument as in Proposition \ref{TensorImpliesWellFormed}.  We need to prove a version of Lemma \ref{signProfilesLemma} which will tell us that if $s\in P_{\oc A}$ then either $\zeta_A(s\vert_n)=O$ for at most one value of $n$.  
  \end{proof}

Just like the tensor product, the exponential $\oc A$ has the property that only player $O$ may switch games.  

The exponential connective gives rise to a functor $\G\to\G$, where the operation on morphisms $\sigma\from A\implies B$ is given by:
\[
  \oc\sigma = \{s\in P_{\oc A\implies \oc B}\suchthat s\vert_{A_n,B_n}\in\sigma\textrm{ for all $n\in\omega$}\}
  \]
with divergences
\[
  D_{\oc\sigma} = \pocl_{\oc A}^O\left(\left\{s \in \oc\sigma\;\middle|\;\mbox{\pbox{\textwidth}{\Centering
    there exists $n\in\omega$ such that $s\vert_n\in D_\sigma$ \\
    and for all $m\ne n$, $s\vert_m\in T_\sigma$
  }}\right\}\right)
  \]
The proof that $\oc(\cdot)$ preserves composition is the same as for the tensor product.

$\oc(\cdot)$ gives rise to a \emph{linear exponential comonad} on $\G$ (see \cite{hyland1997games}, for example).  The relevant natural transformations, including the comultiplication $\mult\from\oc A\to \oc\oc A$, which opens a copy of $A$ on the left for every copy of $A$ opened on the right, are all deterministic, compact, non-divergent strategies.  We only have to show that they are natural transformations.  For illustration, we shall do this in the case of the comultiplication.

\begin{proposition}
  Let $A,B$ be games, and let $\sigma$ be a strategy for $A\implies B$.  Then the following diagram commutes:
  \[
    \begin{tikzcd}
      \oc A \arrow[r, "\mult"] \arrow[d, "\oc \sigma"']
        & \oc \oc A \arrow[d, "\oc \oc \sigma"] \\
      \oc B \arrow[r, "\mult"']
        & \oc \oc B
    \end{tikzcd}
    \]
\end{proposition}
  \begin{proof}
    Both branches of the diagram are strategies that play as $\sigma$ in each copy of $B$ in $\oc \oc B$, opening a copy of $A$ in $\oc A$ as required.  The ordering condition means that there is only one possible order in which to open the copies of $A$ in $\oc A$, so both strategies must behave the same way.

    A divergence occurs in either branch if an only if a divergence arises in $\sigma$ in one of the $A-B$ pairs.  So both branches have the same divergence sets.
  \end{proof}

We may now form the co-Kleisli category $\G^{\oc}$.  The objects of $\G^{\oc}$ are games $A$ and a morphism from $A$ to $B$ is given by a strategy for
\[
  A \iimpl B \coloneqq \oc A \implies B
  \]
We compose two morphisms $\sigma\from A\iimpl B$ and $\tau\from B\iimpl C$ by setting:
\[
  \icomp{\tau}{\sigma} = \oc A \xrightarrow{\mult} \oc \oc A \xrightarrow{\oc \sigma} \oc B \xrightarrow{\tau} C
  \]
where composition on the right is in the category $\G$.

A standard property of the linear exponential comonad is:

\begin{theorem}
  The category $\G^{\oc}$ is Cartesian closed with $\tensor$ as the Cartesian product and $\iimpl$ as the internal Hom.
\end{theorem}

\section{Denotational Semantics for Fair PCF}

Our base PCF type $\nat$ will be denoted by the game $\bN$ defined above, while the product and function types will be interpreted by the connectives $\tensor$ and $\iimpl$.  It remains to give the denotation of each of the terms of Fair PCF as a strategy for the appropriate game.

The numeral $\0$ will each be interpreted as the strategy for $\bN$ that always returns the value $0$, and the function $\suc$ will be the strategy for $\bN\iimpl\bN$ that interrogates its argument and then returns a value that is one greater.  The nondeterministic oracle $\wn$ will be interpreted as the strategy $\wn$ given at the level of trace sets by $\wn=P_{\bN}^P$.  None of these strategies have any divergent positions.

The other PCF terms all have obvious strategies that they correspond to.  The only difficult one is the combinator $\Y_T$.  

As usual, we shall use fixed point theorems from domain theory to define the denotation of $\Y$.  The main ideas come from \cite{LairdOrdinalGames}.

\subsection{The stable order on strategies}

We start by defining some orders on strategies.  Our main ordering, which we shall call the \emph{stable ordering} (following \cite{LairdOrdinalGames}) is the order given in \cite{mcCHFiniteND}.

\begin{definition}[Extensional order]
  Let $A$ be a game and let $\sigma,\tau$ be strategies for $A$.  We say that $\sigma\exle\tau$ if:
  
  \begin{enumerate}[1)]
    \item $T_\sigma\subset T_\tau$
    \item $D_\tau\subset D_\sigma$
  \end{enumerate}
\end{definition}

The extensional order is simple to define, but it is not preserved by composition (see \cite{mcCHFiniteND} for an example).  Instead, we shall use the stable order, which is preserved by composition:

\begin{definition}[Stable order]
  Let $A$ be a game and let $\sigma,\tau$ be strategies for $A$.  We say that $\sigma\stle\tau$ if:

  \begin{enumerate}[1)]
    \item $T_\sigma\subset T_\tau$
    \item $D_\tau\subset D_\sigma$
    \item $T_\tau\subset T_\sigma \cup \pocl_A^P(D_\sigma)$
  \end{enumerate}
\end{definition}

To show that this is an order, the only non-trivial part is to show that property (3) is transitive.  Suppose that $\sigma\stle\tau\stle\upsilon$ are strategies and that $s\in T_\upsilon\setminus T_\tau$.  If $s\in T_\tau$, then there exists $d\in D_\sigma$ such that $d\prefix s$, since $\sigma\stle\tau$ and if $s\not\in T_\tau$, then there exists $d\in D_\tau\subset D_\sigma$ such that $d\prefix s$, since $\tau\stle\upsilon$.  Therefore, $\sigma\stle\upsilon$.

\begin{proposition}
  \label{compositionMonotonicSO}
  Let $A,B,C$ be games, let $\sigma,\sigma'$ be strategies for $A\implies B$ and let $\tau,\tau'$ be strategies for $B\implies C$.  Suppose that $\sigma\stle\sigma'$ and $\tau\stle\tau'$.  Then:
  \[
    \comp\tau\sigma\stle\comp{\tau'}{\sigma'}
    \]
\end{proposition}
  \begin{proof}
    First suppose that $\tau=\tau'$.  

    Since $T_\sigma\subset T_{\sigma'}$, we have $\sigma\|\tau\subset\sigma'\|\tau$ and therefore $T_{\comp\tau\sigma}\subset T_{\comp{\tau}{\sigma'}}$.  

    Now let $e\in D_{\comp{\tau}{\sigma'}}$.  Suppose $\e\vert_{A,C}\prefix e$, where $\e\in\sigma'\dv\tau$, and suppose first that $\e\vert_{A,B}\in D_{\sigma'}$ and $\e\vert_{B,C}\in T_{\tau}$.  Since $D_{\sigma'}\subset D_\sigma$, we have $\e\vert_{A,B}\in D_\sigma$, so $\e\in\sigma\dv\tau$ and therefore $e$, which is a postfix of $\e\vert_{A,C}$, is contained in $D_{\comp\tau\sigma}$.  
    
    Now suppose that $\e\vert_{A,B}\in T_{\sigma'}$ and $\e\vert_{B,C}\in D_{\tau}$.  Since $\sigma\stle\sigma'$, we have $\e\vert_{A,B}\in T_\sigma\cup \pocl_A^O(D_\sigma)$.  If $\e\vert_{B,C}\in T_\sigma$, then we have $\e\in\sigma\dv\tau$ and so $\e\vert_{A,C}\in D_{\comp\tau\sigma}$ and therefore $e\in D_{\comp\tau\sigma}$, since $D_{\comp\tau\sigma}$ is postfix-closed.  

    Otherwise, there exists $d\in D_\sigma$ such that $d\prefix\e\vert_{B,C}$.  Then $\e\vert_{A,B}$ and $\e\vert_{B,C}$ have prefixes $q\prefix\e\vert_{A,B}$, $r\prefix\e\vert_{B,C}$ such that $q\in D_\sigma$, $r\in D_\tau$ and for all $P$-prefixes $q'\prefix q, r'\prefix r$ we have $q'\in T_\sigma$ and $r'\in T_\tau$.  Passing to an appropriate prefix $\e'$ of $\e$, we have either $\e'\vert_{A,B}=q$ and $r\prefix\e'\vert_{B,C}$ or $q\prefix\e'\vert_{A,B}$ and $\e\vert_{B,C}=r$.  In either case, $\e'\in \sigma\dv\tau$ and so $\e'\vert_{A,C}\in D_{\comp\tau\sigma}$.  Then we have $\e'\vert_{A,C}\prefix\e\vert_{A,C}\prefix e$, and so $e\in D_{\comp\tau\sigma}$.  

    Lastly, suppose that $s\in T_{\comp{\tau}{\sigma'}}\setminus T_{\comp\tau\sigma}$.  Write $s=\s$, where $\s\in\sigma'\|\tau$.  Since $\s\not\in T_{\comp\tau\sigma}$, we must have $\s\vert_{A,B}\in\sigma'\setminus\sigma$.  It follows that there exists $d\in D_\sigma$ such that $d\prefix\s\vert_{A,B}$ and therefore $\s\in\sigma\dv\tau$.  Therefore, $d\prefix\s\vert_{A,B} = s$.

    The result follows by a similar argument in the case that $\sigma=\sigma'$.  Therefore, the full result follows from transitivity of $\stle$: if $\sigma\stle\sigma'$ and $\tau\stle\tau'$, then
    \[
      \comp\tau\sigma \stle \comp\tau{\sigma'} \stle \comp{\tau'}{\sigma'}
      \]
  \end{proof}

We want to get a similar result for composition in the category $\G^{\oc}$.  To do that it will suffice to prove the following result:

\begin{proposition}
  \label{exponentiationMonotonicSO}
  Let $A,B$ be games and let $\sigma,\tau$ be strategies for $A\implies B$ such that $\sigma\stle\tau$.  Then $\oc\sigma\stle\oc\tau$ as strategies for $\oc A\implies \oc B$.
\end{proposition}
  \begin{proof}
    If $s\in\oc\sigma$, then $s\vert_{A_n,B_n}\in\sigma$ for all $n$ and therefore $s\vert_{A_n,B_n}\in\sigma'$ for all $n$.  It follows that $\oc\sigma\subset\oc\tau$.

    If $e\in D_{\oc\tau}$ then there exists some $e'\prefix e$ and some $n\in\omega$ such that $e'\vert_n\in D_\tau$ and $e'\vert_m\in T_\tau$ for all $m\ne n$.  

    Since $\sigma\stle\tau$, we have $D_\tau\subset D_\sigma$ and $T_\tau\subset T_\sigma\cup \pocl_A^P(D_\sigma)$.  For each $m$, define a subsequence $d_n$ of $e'$ as follows: if $e'\vert_m\in T_\sigma$ then $d_m=e'\vert_m$.  If $e'\vert_m\in \pocl_A^P(D_\sigma)$, then there is some prefix of $e'\vert_m$ that is an $O$-position in $D_\sigma$, all of whose $P$-prefixes are in $T_\sigma$.  Let $d_m$ be the shortest such prefix of $e'\vert_m$.

    We know that $e'\vert_n\in D_\tau\subset D_\sigma$, so $d_n\in D_\sigma$.  Let $d$ be the shortest prefix of $e'$ such that there exists some $m$ such that $d_m\in D_\sigma$ and $d_m\prefix d$.  Write $d=d'a$.  We claim that $a$ is the last move in $d_m$ and that $d\vert_k\in T_\sigma$ for all $k\neq m$.  Certainly, $a$ is a move in $d_m$; otherwise, we could remove it and get a shorter sequence that still contains $d_m$ as a subsequence.  If $d\vert_k\prefix d_k$, then $d\vert_k\in T_\sigma$, since it is a $P$-position by examination of sign profiles.  Otherwise, $d_k\pprefix d\vert_k$.  But this contradicts the minimality of $d$.  

    Therefore, we have $d\in D_{\oc\sigma}$.  It follows that $e\in D_{\oc\sigma}$, since $D_{\oc\sigma}$ is postfix-closed.

    Lastly, if $s\in \oc\tau\setminus\oc\sigma$, then there exists some $s'\prefix s$ and some $n\in\omega$ such that $s'\vert_{A_n,B_n}\in\tau\setminus\sigma$.  Therefore, if we construct the $d_n$ as before, we have $d_n\in D_\sigma$ for at least one $n$ and it follows that we may construct $d\in D_{\oc\sigma}$ as before such that $d\prefix s'$.  It follows that $s\in D_{\oc\sigma}$.  
  \end{proof}

If $A$ is a game and $S\subset P_A$ is some set, we say that $s\in S$ is \emph{minimal} if $t\not\in S$ for all proper prefixes $t\pprefix s$.  Let $A$ be a game and let $F$ be a non-empty set of strategies for $A$ that is directed under the extensional order: so if $\sigma,\tau\in F$ then there is some $\upsilon\in F$ such that $\sigma,\tau\exle\upsilon$.  We define a strategy $\exlub F$ for $F$ by setting
\begin{gather*}
  T_{\exlub F} = \bigcup_{\sigma\in F}T_\sigma \\
  D_{\exlub F} = \bigcap_{\sigma\in F}D_\sigma
\end{gather*}

\begin{proposition}
  If $A$ is a game and $F$ is a set of strategies for $A$ that is directed under the extensional order then $\exlub F$ is a strategy for $A$.
\end{proposition}
  \begin{proof}
    $T_{\exlub F}$ is certainly non-empty and prefix-closed in $T_{\exlub F}$.  Similarly, $D_{\exlub F}$ is certainly postfix-closed.  Suppose that $s\in D_{\exlub F}$.  For each $\sigma\in F$, there exists some prefix $t_\sigma\prefix s$ such that $t_\sigma\in D_\sigma$ and $u\in T_\sigma$ for all $P$-prefixes $u\prefix t_\sigma$.  Let $t$ denote the limit of the $t_\sigma$.  Then $t$ is an $O$-position, since $s$ and the $t_\sigma$ are $O$-positions, so every $P$-prefix of $t$ is a $P$-prefix of one of the $t_\sigma$ and is therefore contained in $T_\sigma\subset T_{\exlub F}$.  Moreover, $t\in D_\sigma$ for all $\sigma$ by postfix closure of the $D_\sigma$.  

    To show that $\exlub F$ satisfies diverge-or-reply, suppose that $s\in T_{\exlub F}$ and that $sa\in P_A$ is such that $sa\not\in D_{\exlub F}$.  Then there exist $\sigma,\tau\in F$ such that $s\in T_\sigma$ and $sa\not\in D_\tau$.  Since $F$ is directed under the extensional order, there exists some strategy $\upsilon\in F$ such that $\sigma,\tau\exle\upsilon$.  In particular, $s\in T_\upsilon$ and $sa\not\in D_\upsilon$.  It follows that $sab\in T_\upsilon\subset T_{\exlub F}$ for some $b$.  Therefore, $\exlub F$ satisfies diverge-or-reply.

    Lastly, we show that $\exlub F$ is locally compact.  Let $s\in T_{\exlub F}$.  Then there is some compact strategy $\sigma'$ such that $s\in T_{\sigma'}$ and $\sigma'\exle\sigma\exle\exlub F$.  
  \end{proof}

$\exlub F$ is clearly a least upper bound for directed sets of strategies under the extensional ordering.  More suprisingly, $\exlub F$ is a least upper bound for directed sets of strategies under the stable ordering.

\begin{proposition}
  \label{exlubIsStlub}
  Let $A$ be a game, and let $F$ be a set of strategies for $A$ that is directed under the stable ordering -- so if $\sigma,\tau\in F$ then there is some strategy $\upsilon\in F$ such that $\sigma,\tau\stle\upsilon$.  Then $\exlub F$ is a least upper bound for $F$ under the ordering $\stle$.
\end{proposition}
  \begin{proof}
    First we show that $\exlub F$ is a stable upper bound for $F$.  Let $\sigma\in F$.  Certainly $T_\sigma\subset T_{\exlub F}$ and $D_{\exlub F}\subset D_\sigma$, so it remains to show that $T_{\exlub F}\subset T_\sigma\cup \pocl_A^P(D_\sigma)$.  Suppose $s\in T_{\exlub F}$.  Then $s\in T_\tau$ for some strategy $\tau$.  Since $F$ is stably directed, there exists some strategy $\upsilon\in F$ such that $\sigma,\tau\stle\upsilon$.  In particular:
    \[
      s\in T_\upsilon \subset T_\sigma \cup \pocl_A^P(D_\sigma)
      \]

    Now suppose that $\alpha$ is a stable upper bound for $F$; we need to show that $\exlub F\stle\alpha$.  Since we have $T_\sigma\subset T_\alpha$ and $D_\alpha\subset D_\sigma$ for all $\sigma\in F$, we have $T_{\exlub F}\subset T_\alpha$ and $D_\alpha\subset D_{\exlub F}$.  Now suppose that $s\in T_\alpha\setminus\pocl_A^P(D_{\exlub F})$.  Then there exists some $\sigma\in F$ such that $d\not\prefix s$ for all $d\in D_\sigma$.  It follows that $s\in T_\alpha\setminus\pocl_A^P(D_\sigma)$; since $D_\sigma\stle D_\alpha$, we must have $s\in T_\sigma\subset T_{\exlub F}$. 
  \end{proof}

Now let $A$ be a game and let $\tau$ be a strategy for $A\iimpl A$.  The set $\Strat(A)$ of strategies for $A$ is directed-complete under the stable ordering $\stle$ and map $\tau_*\from\Strat(A)\to\Strat(A)$ given by $\sigma\mapsto\icomp\tau\sigma$ is monotone with respect to $\stle$, by Propositions \ref{compositionMonotonicSO} and \ref{exponentiationMonotonicSO}.  Therefore, by the Bourbaki-Witt theorem, there is a $\stle$-least fix-point of $\tau_*$, which we shall call $\fix_\tau$.

Let $T$ be a PCF term with denotation $A$ and let $\chi_A$ be the strategy for $((A \iimpl A) \iimpl A) \iimpl ((A \iimpl A) \iimpl A)$ corresponding to the $\lambda$-term $\lambda F.\lambda f. f(F f)$.  We define
\[
  \deno{\Y_T} = \fix_{\chi_A}
  \]

\subsection{Consistency}

Our proofs for soundness and adequacy follow \cite{LairdOrdinalGames}.  However, we are forced to use a new technique to prove adequacy, because unlike the model given in \cite{LairdOrdinalGames}, our model does not have the property that function application is continuous with respect to functions in the stable order.

\begin{lemma}
  \label{jimsLemma}
  Let $M$ be a reducible program of type $T$.  Let $F_M = \{N\suchthat M\opto N\}$.  Then $T_{\deno{M}}\subset\bigcup_{N\in F_M} T_{\deno{N}}$ and $D_{\deno{M}}\subset \bigcup_{N\in F_M} D_{\deno{N}}$.
\end{lemma}
  \begin{proof}
    Structural induction on $M$.  If $M=\wn$, then $F_M$ is the set of numerals, and we have $T_\wn = \bigcup_{n\in \omega} \{\emptyplay, qn\}$ and $D_\wn=\emptyset$.  Otherwise, write $M = FN$ for some term $L$ of type $S\to T$ and some term $N$ of type $T$.  Write $A=\deno{S}$, $B=\deno{T}$, $\sigma=\deno{N}$ and $\tau=\deno{F}$.  So $\sigma$ is a strategy for $A$ and $\tau$ is a strategy for $A\iimpl B = \oc A \implies B$.  If $FN$ is reducible via one of the rules
    \[
      \begin{tabular}{cc}
        \inferrule{ }{(\lambda x.M)N\opto M[N/x]}
          & \inferrule{ }{\Y M \opto M(\Y M)} \\
        \inferrule{ }{\IfO \0 \opto \lambda x.\lambda y.x}
          & \inferrule{ }{\IfO (\suc\n) \opto \lambda x.\lambda y.y(\n)}
      \end{tabular}
      \]
    then $FN$ is not reducible via any other rule; moreover, in all of these cases, the terms on either side of the $\opto$ arrow have the same denotations (by structural induction in the case of the $\beta$-reduction).  Now suppose that $FN$ is reducible by one of the rules
    \[
      \begin{tabular}{cc}
        \inferrule{M\opto M'}{\suc M\opto \suc M'}
          & \inferrule{M\opto M'}{\IfO M \opto \IfO M'}
      \end{tabular}
      \]
    Let $s\in T_{\comp\tau\sigma}$, and write $s=\s\vert_B$, where $\s\in\sigma\|\tau$.  By structural induction, there is some term $N'$, having denotation $\sigma'$, such that $N\to N'$ and $\s\vert_A\in T_{\sigma'}$.  Then we have $s=\s\vert_B\in T_{\comp\tau{\sigma'}}$.

    Now suppose that $d\in D_{\comp\tau\sigma}$.  Then there is some $\d\in \oc\sigma\dv\tau$ such that $\d\vert_B\prefix d$.  Since the denotations for $\IfO$ and $\suc$ do not contain any divergences, we must have $\d\in T_\sigma$ and $\d\vert_{\oc A}\in D_{\oc \sigma}$.  Moreover, the denotations of $\IfO$ and $\suc$ only interrogate their argument once.  So $\d\vert_{A_0}\in D_\sigma$ and $\d\vert_{A_n}=\emptyplay$ for $n\ne 0$.  By structural induction there is some $N'$, having denotation $\sigma'$, such that $N\opto N'$ and $\d\vert_{A_0}\in D_{\sigma'}$, and therefore we have $\d\vert_A\in D_{\oc\sigma'}$.  It follows that $\d\in D_{\icomp{\tau}{\sigma'}}$.  

    Lastly, suppose that $F N$ is reducible by the rule
    \[
      \begin{tabular}{c}
        \inferrule{M\opto M'}{M N\opto M' N}
      \end{tabular}
      \]
    Let $s\in T_{\comp\tau\sigma}$ and write $s=\s\vert_B$, where $\s\in\sigma\|\tau$.  In particular, $\s\in T_\tau$.  By structural induction, there is some term $F'$, having denotation $\tau'$, such that $F\to F'$ and $\s\in T_{\tau'}$.  Then $s=\s\vert_B\in T_{\comp{\tau'}{\sigma}}$.  

    Now suppose that $d\in D_{\comp\tau\sigma}$.  Then there is some $\d\in\oc\sigma\dv\tau$ such that $\d\vert_B\prefix d$.  Suppose first that $\d\vert_A\in D_{\oc\sigma}$ and that $\d\in T_\tau$.  By structural induction, there is some $F'$, having denotation $\tau'$, such that $F\to F'$ and $\d\in T_{\tau'}$.  Then $\d\in\oc\sigma\dv\tau'$, so $\d\vert_B\in D_{\comp{\tau'}\sigma}$.

    Suppose instead that $\d\vert_A\in T_{\oc\sigma}$ and that $\d\in D_\tau$.  By structural induction, there is some $F'$, having denotation $\tau'$, such that $F\to F'$ and $\d\in D_{\tau'}$.  Then $\d\in\oc\sigma\dv\tau'$, so $\d\vert_B\in D_{\tau'}$.  
  \end{proof}

\begin{theorem}[Consistency]
  Let $M$ be a program of type $\nat$.  If $M\mustconverge$, then $D_{\deno{M}} = \emptyset$.
\end{theorem}
  \begin{proof}
    Suppose $d\in D_{\deno M}$.  The only irreducible programs of type $\nat$ are the numerals, whose denotations do not contain any divergences, so $M$ must be reducible.  Therefore, by Lemma \ref{jimsLemma}, there exists some $M_1$ such that $M\to M_1$ and $d\in D_{\deno {M_1}}$.  So $M_1$ is reducible and we may apply Lemma \ref{jimsLemma} again to get a term $M_2$ such that $M_1\to M_2$ and $d\in D_{\deno {M_2}}$.  We keep on applying Lemma \ref{jimsLemma} and build up a sequence $M\to M_1\to M_2\to M_3\to\cdots$.  Therefore, $M\not\mustconverge$.
  \end{proof}

To prove computational adequacy, we define Plotkin-style approximation relations (\cite{PlotkinApRels}, cited in \cite{LairdOrdinalGames}).  

\begin{definition}
  For each PCF type $T$, we define a relation $\plot_T$ between strategies for $\deno{T}$ and closed terms of type $T$:

  \begin{itemize}
    \item $\sigma \plot_\nat M$ if $M\not\mustconverge$ implies that $q\in D_\sigma$ and $qn\in T_\sigma$ implies that $M\opto^* \n$.
    \item $\tau \plot_{S\to T} P$ if $\sigma\plot_S N$ implies that $\icomp\tau\sigma \plot_T P N$
  \end{itemize}
\end{definition}

\begin{lemma}
  \label{jims2ndLemma}
  i) If $M$ is a term of type $\nat$ such that $M\opto N$ for some unique term $N$, and if $\sigma\plot_\nat N$, then $\sigma\plot_\nat M$

  ii) If $M$ is a term of type $T$ and $\sigma,\tau$ are strategies for $\deno{M}$ such that $\sigma\stle\tau$, and if $\tau\plot_TM$, then $\sigma\plot_TM$.
\end{lemma}
  \begin{proof}
    (i): Suppose $M\opto N$ for some unique term $N$ and suppose that $\sigma\plot_\nat N$.  Then, if $M\not\mustconverge$, we must have $N\not\mustconverge$.  Therefore, $q\in D_\sigma$.  Suppose $qn\in T_\sigma$.  Then $N\opto^*\n$, so $N\opto^*\n$.

    (ii): Structural induction on $T$.  let $M$ be a term of type $\nat$.  Suppose $\sigma,\tau$ are strategies for $\bN$, that $\sigma\stle\tau$ and that $\tau\plot_T M$.  If $M\not\mustconverge$, then $q\in D_\tau$, so $q\in D_\sigma$.  If $qn\in T_\sigma$, then $qn\in T_\tau$, so $M\opto^*\n$.

        Now let $P$ be a term of type $S\to T$.  Write $A=\deno{S}$ and $B=\deno{T}$.  Suppose that $\tau,\tau'$ are strategies for $A\iimpl B$ such that $\tau\stle\tau'$ and such that $\tau'\plot_{S\to T}P$.  Suppose that $\sigma\plot_SN$ for some term $N$ of type $S$.  Then $\icomp{\tau'}{\sigma}\plot_TPN$.  Since $\tau\stle\tau'$, $\icomp{\tau}{\sigma}\stle\icomp{\tau'}{\sigma}$, by Propositions \ref{compositionMonotonicSO} and \ref{exponentiationMonotonicSO}.  Therefore, by structural induction, we have $\icomp{\tau}{\sigma}\plot_TPN$.  Since $\sigma,N$ were abitrary, it follows that $\tau\plot_{S\to T}P$.
  \end{proof}

In order to prove adequacy, it will suffice to show that $\deno{M}\plot_TM$ for all terms $M$ of type $T$.  In most cases, this is a simple induction.  The only tricky part will be showing that it is true for the recursion combinator.

\begin{lemma}
  \label{jimY}
  Let $T$ be a PCF type.  Then $\deno{\Y_T}\plot_{(T\to T)\to T}\Y_T$.
\end{lemma}

  In order to show this, we would like to be able to say that if $F$ is a stably directed set of strategies for $\deno{T}$ such that $\sigma\plot_T M$ for all $\sigma\in F$, then $\exlub F\plot_TM$, but it seems difficult to prove this, since function application is not continuous with respect to functions.  Instead, we shall pass to a slightly finer class of strategies, in which composition is continuous with respect to functions (but not to arguments).  We shall then be able to pass back to our original model and get our proof of Lemma \ref{jimY}.

\subsection{Multistrategies}

\begin{definition}
  Let $A$ be a game.  A \emph{multistrategy} for $A$ is a stably directed set $\Sigma$ of strategies for $A$.  (So the set of multistrategies for $A$ is the free directed-completion of the set of strategies for $A$).

  We can extend the stable order to multistrategies.  This time, $\stle$ is a preorder rather than being a full order.

  Let $A$ be a game, and let $\Sigma,\Tau$ be multistrategies for $A$.  We say that $\Sigma\stle\Tau$ if for all $\tau\in\Tau$ there exists $\sigma\in\Sigma$ such that $\sigma\stle\tau$.

  We say that $\Sigma \steq \Tau$ if $\Sigma\stle\Tau$ and $\Tau\stle\Sigma$.
\end{definition}

\begin{lemma}
  Let $A$ be a game, let $\sigma$ be a strategy for $A$ and let $\Sigma$ be a multistrategy for $A$ such that $\{\sigma\}\steq\Sigma$.  Then $\sigma\in\Sigma$ and is a $\stle$-least element of $\Sigma$.
\end{lemma}
  \begin{proof}
    Since $\Sigma\stle\{\sigma\}$, we know that $\tau\stle\sigma$ for all $\tau\in\Sigma$.  Since $\{\sigma\}\stle\Sigma$, we know that $\sigma\stle\tau$ for some $\tau\in\Tau$ and hence by antisymmetry that $\sigma\in\Sigma$.
  \end{proof}

Conversely, if $\Sigma$ is a strategy with a $\stle$-greatest element $\sigma$, then $\{\sigma\}\steq\Sigma$.

\begin{definition}
  Let $A$ be a game and let $F$ be a set of multistrategies for $A$ that is directed with respect to $\stle$.  The least upper bound of $F$ is given by the union of the multistrategies contained in $F$:
  \[
    \exlub F = \bigcup_{\Sigma\in F}\Sigma
    \]
\end{definition}

\begin{proposition}
  \label{multiExlubIsStlub}
  $\exlub F$ is a $\stle$-least upper bound for $F$.

\end{proposition}
  \begin{proof}
    Let $\Sigma\in F$.  Then for each $\sigma\in\Sigma$, we have $\sigma\stle\sigma\in \exlub F$.  So $\Sigma\stle\exlub F$.  Conversely, suppose that $\Xi$ is some other upper bound for $\Sigma$.  Let $\sigma\in \exlub F$.  Then $\sigma\in \Sigma$ for some $\Sigma\in F$.  Therefore, since $\Sigma\stle\Xi$, there is some $\xi\in \Xi$ such that $\sigma\stle\xi$.  Therefore, $\exlub F\stle\Xi$.
  \end{proof}

\begin{definition}
  Let $A,B,C$ be games, let $\Sigma$ be a multistrategy for $A\iimpl B$ and let $\Tau$ be a multistrategy for $B\iimpl C$.  Then we define:
  \[
    \icomp\Tau\Sigma = \left\{\exlub_{\sigma\in\Sigma}(\icomp\tau\sigma)\suchthat\tau\in\Tau\right\}
    \]
  By Lemmas \ref{compositionMonotonicSO} and \ref{exponentiationMonotonicSO} and Proposition \ref{exlubIsStlub}, this is still stably directed.
\end{definition}

Note that composition of multistrategies is \emph{not} necessarily associative and does not satisfy the rules for the identity, even up to $\steq$.  The reason for this is the failure of composition of strategies to be continuous.  However, we can show that $\icomp{\{\upsilon\}}{(\icomp\Tau\Sigma)}=\icomp{(\icomp{\{\upsilon\}}\Tau)}\Sigma$ for all multistrategies $\Sigma,\Tau$ and all strategies $\upsilon$.  Similarly, $\icomp{\{\id\}}{\{\sigma\}}=\{\sigma\}$ and $\icomp{\Sigma}{\{\id\}}=\{\Sigma\}$ for all strategies $\sigma$ and multistrategies $\Sigma$.  We will not use these facts directly here, but it might be useful for future work to work out what the principles are behind our argument.

What is clear is that composition is monotonic with respect to the stable ordering on multistrategies.  Our main point of interest is that $\comp\Tau\Sigma$ is now continuous with respect to $\Tau$.

\begin{proposition}
  \label{RareContinuityResult}
  i) Let $A,B,C$ be games, let $\Sigma,\Sigma'$ be multistrategies for $A\implies B$ and let $\Tau,\Tau'$ be multistrategies for $B\implies C$ such that $\Sigma\stle\Sigma'$ and $\Tau\stle\Tau'$.  Then $\icomp\Tau\Sigma\stle\icomp{\Tau'}{\Sigma'}$.  

  ii) Let $A,B,C$ be games, let $\Sigma$ be a multistrategy for $A\implies B$ and let $F$ be a stably directed set of multistrategies for $B\implies C$.  Then
      \[
        \icomp{\left(\exlub_{\Tau\in F}\Tau\right)}\Sigma = \exlub_{\Tau\in F}(\icomp\Tau\Sigma)
        \]
\end{proposition}
\begin{proof}
  (i): We have $\Sigma\stle\Sigma'$ and it follows that $\exlub_{\sigma\in\Sigma}\sigma\stle\exlub_{\sigma\in\Sigma'}\sigma$ by Proposition \ref{exlubIsStlub} and the definition of $\stle$ for multistrategies.  Then, if $\exlub_{\sigma\in\Sigma}\icomp\tau\sigma$ is an arbitrary element of $\icomp\Tau\Sigma$, we know that there exists some $\tau'\in \Tau'$ such that $\tau\stle\tau'$.  Now we have
  \[
    \exlub_{\sigma\in\Sigma}\icomp\tau\sigma\stle\exlub_{\sigma\in\Sigma}\icomp{\tau'}{\sigma}
    \]
  by Proposition \ref{compositionMonotonicSO}, together with usual properties of least upper bounds.

  (ii): We have:
  \begin{align*}
    \icomp{\left(\exlub_{\Tau\in F}\Tau\right)}\Sigma & = \left\{\exlub_{\sigma\in\Sigma}(\icomp\tau\sigma)\suchthat\tau\in\bigcup_{\Tau\in F}\Tau\right\} \\
      & = \bigcup_{\Tau\in F}\left\{\exlub_{\sigma\in \Sigma}(\icomp\tau\sigma)\suchthat\tau\in\Tau\right\} \\
      & = \exlub_{\Tau\in F}\left(\icomp\Tau\Sigma\right)
  \end{align*}
\end{proof}

Note that our definition of composition $\icomp\Tau\Sigma$ is not necessarily continuous with respect to $\Sigma$.  For example, if $\Tau=\{\tau\}$ is a singleton strategy and $F$ is a set of multistrategies composable with $\Tau$, then $\exlub_{\Sigma\in F}(\icomp{\{\tau\}}\Sigma$ may contain multiple elements, but $\icomp{\{\tau\}}{\left(\exlub_{\Sigma\in F}\Sigma\right)}$ is always a singleton.

\subsection{Adequacy}

We now extend the definition of the predicates $\plot_T$ to multistrategies.  

\begin{definition}
  For each PCF type $T$, we define a relation $\plot_T$ between multistrategies for $\deno{T}$ and closed terms of type $T$: we say that $\Sigma\plot_TM$ if $\sigma\plot_TM$ for all $\sigma\in\Sigma$.  
\end{definition}

We now prove a stronger version of Lemma \ref{jims2ndLemma} that holds for multistrategies.  

\begin{lemma}
  \label{multijims2ndLemma}
  i) If $M$ is a term of type $\nat$ such that $M\opto N$ for some unique term $N$, and if $\Sigma\plot_\nat N$, then $\Sigma\plot_\nat M$

  ii) If $M$ is a term of type $T$ and $\Sigma,\Tau$ are multistrategies for $\deno{M}$ such that $\Sigma\stle\Tau$, and if $\Tau\plot_TM$, then $\Sigma\plot_TM$.

  iii) If $M$ is a term of type $T$ and $F$ is a stably directed set of multistrategies for $\deno{T}$ such that $\Sigma\plot_TM$ for all $\Sigma\in F$, then $\exlub F\plot_TM$.
\end{lemma}
\begin{proof}
  (i) and (ii) follow immediately from Lemma \ref{jims2ndLemma} and the definition of $\stle$ for multistrategies.

  (iii): Structural induction on $T$.  If $T=\nat$ and $M\not\mustconverge$, then $q\in D_\sigma$ for all $\sigma$ such that $\sigma\in\Sigma$ for some $\Sigma\in F$.  Thus, $q\in D_\sigma$ for all $\sigma\in\exlub F$.  If $qn\in T_{\exlub F}$ then $qn\in T_\Sigma$ for some $\Sigma\in F$.  Then, since $\Sigma\plot_\nat M$, we have $M\opto^*\n$.  

  Now suppose that $T=Q\to R$ and that $M$ is a term of type $Q\to R$ such that $\Tau\plot_{Q\to R}M$ for all $\Tau\in F$.  Write $A=\deno{Q}$ and $B=\deno{R}$.  Let $\sigma$ be a strategy for $A$ such that $\sigma\plot_QN$ and write $\Sigma$ for the multistrategy $\{\sigma\}$.  For each $\Tau\in F$, we have $\icomp\Tau\Sigma = \{\icomp\tau\sigma\suchthat\tau\in\Tau\}$.  We have $\icomp\tau\sigma\plot_RMN$ for each $\tau$, so $\icomp\Tau\Sigma\plot_RMN$ for each $\Tau\in F$.  By structural induction, we must have $\exlub_{\Tau\in F}(\icomp\Tau\Sigma)\plot_RMN$.  Now, by Proposition \ref{RareContinuityResult}, we have $\exlub_{\Tau\in F}(\icomp\Tau\Sigma)=\icomp{\left(\exlub_{\Tau\in F}\Tau\right)}\Sigma$ and therefore $\icomp\tau\sigma\plot_RMN$ for each $\tau\in\exlub_{\Tau\in F}\Tau$.  Since $\sigma, N$ were arbitrary, it follows that $\exlub F\plot_{Q\to R}M$.  
\end{proof}

We now have the technical machinery ready to prove Lemma \ref{jimY}.

\begin{proof*}{Proof of Lemma \ref{jimY}}
  Recall that we constructed $\deno{\Y_T}$ as the $\stle$-least fixed point of the strategy $\chi_A$ for $((A\iimpl A)\iimpl A)\iimpl((A\iimpl A)\iimpl A)$ corresponding to the lambda term $\lambda F.\lambda f.f(F f)$, where $A=\deno T$.  This fixed point exists because the set of strategies for $((A\iimpl A)\iimpl A)$ is directed complete.  

  Let $S$ denote the set of multistrategies for $(A\iimpl A)\iimpl A$ such that $S\plot_{(T\to T)\to T}\Y_T$.  By Lemma \ref{multijims2ndLemma}, part (iii), $S$ is directed complete with respect to $\stle$.  Write $\Chi_A$ for the multistrategy $\{\chi_A\}$.  We first claim that if $\Sigma\in S$ then $\comp{\Chi_A}{\Sigma}\in S$.

  Write $T=T_1\to\dots\to T_k\to\nat$.  Let $N\from T\to T,N_1\from T_1,\dots,N_k\from T_k$ be terms and let $\tau\from\deno{T\to T},\sigma_1\from\deno{T_1},\dots,\sigma_k\from\deno{T_k}$ be strategies such that $\sigma_i\plot_{T_i}N_i$ for $i=1,\dots,k$.  

  We have $\Sigma\in S$, so for all $\sigma\in\Sigma$ we have $\comp{\comp\sigma\tau}{\comp{\sigma_1}{\comp{\cdots}{\sigma_k}}}\plot_\nat\Y_TNN_1\dots N_k$.  By a standard argument, $\chi_A\plot_{((T\to T)\to T)\to(T\to T)\to T}\lambda F.\lambda f.f(F f)$ and so we have
  \[
    \icomp{\chi_A}{\icomp{\sigma}{\icomp{\tau}{\icomp{\sigma_1}{\icomp{\dots}{\sigma_k}}}}}\plot_{\nat}(\lambda F.\lambda f.f(F f))\Y_T N N_1\dots N_k
    \]
  Therefore:
  \[
    \icomp{\chi_A}{\icomp{\sigma}{\icomp{\tau}{\icomp{\sigma_1}{\icomp{\dots}{\sigma_k}}}}}\plot_{\nat}N(\Y_T) N N_1\dots N_k
    \]
  Therefore, by part Lemma \ref{jims2ndLemma}, part (i), we have
  \[
    \icomp{\chi_A}{\icomp{\sigma}{\icomp{\tau}{\icomp{\sigma_1}{\icomp{\dots}{\sigma_k}}}}}\plot_{\nat}\Y_T N N_1\dots N_k
    \]
  Since $N,N_1,\dots,N_k,\tau,\sigma_1,\dots,\sigma_k$ were arbitrary, we see that $\icomp{\chi_A}{\sigma}\plot_{(T\to T)\to T}\Y_T$.
\end{proof*}

\bibliographystyle{entcs}
\bibliography{phd_bibliography}

\end{document}
